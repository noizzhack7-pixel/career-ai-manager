<!-- AI Loading Overlay -->
<div *ngIf="isLoadingComparison"
    class="fixed inset-0 bg-gray-900/80 backdrop-blur-sm z-50 flex items-center justify-center">
    <div class="bg-white rounded-3xl shadow-2xl p-10 max-w-md w-full mx-4 text-center">
        <!-- Spinner Container -->
        <div class="relative w-32 h-32 mx-auto mb-8">
            <!-- Outer pulsing ring -->
            <div class="absolute inset-0 rounded-full spinner-outer"></div>
            <!-- Main spinning ring -->
            <div class="absolute inset-2 rounded-full border-4 spinner-main"></div>
            <!-- Inner spinning ring (opposite direction) -->
            <div class="absolute inset-4 rounded-full border-4 spinner-inner"></div>
            <!-- Center AI icon -->
            <div class="absolute inset-0 flex items-center justify-center">
                <div
                    class="w-16 h-16 bg-gradient-to-br from-primary to-primaryDark rounded-2xl flex items-center justify-center shadow-lg animate-pulse">
                    <i class="fa-solid fa-brain text-white text-2xl"></i>
                </div>
            </div>
        </div>

        <!-- Loading Text -->
        <h2 class="text-2xl font-bold text-gray-800 mb-3">AI מעבד נתונים</h2>
        <p class="text-primary font-medium text-lg mb-4 min-h-[28px] transition-all duration-300">{{ loadingText }}</p>

        <!-- Progress dots -->
        <div class="flex justify-center items-center space-x-2 space-x-reverse">
            <span class="w-2 h-2 bg-primary rounded-full loading-dot"></span>
            <span class="w-2 h-2 bg-primary rounded-full loading-dot"></span>
            <span class="w-2 h-2 bg-primary rounded-full loading-dot"></span>
        </div>

        <!-- Subtitle -->
        <p class="text-softGray text-sm mt-6">מערכת הבינה המלאכותית מנתחת ומשווה בין המועמדים הנבחרים</p>
    </div>
</div>


<!-- Jobs List View -->
<div *ngIf="!selectedJob && !showComparisonView" class="flex">
    <!-- Right Sidebar -->
    <div class="w-80 bg-white h-[calc(100vh-80px)] shadow-sm border-l border-gray-200 overflow-y-auto">
        <div class="p-6">
            <!-- Filter Section -->
            <div class="mb-8">
                <h3 class="text-base font-bold text-gray-800 mb-4 flex items-center space-x-2 space-x-reverse">
                    <i class="fa-solid fa-sliders text-primary"></i>
                    <span>סינון התאמות</span>
                </h3>

                <div class="space-y-4">
                    <div>
                        <label class="text-sm font-medium text-gray-800 mb-2 block">איכות התאמה</label>
                        <input type="range" min="0" max="100" [(ngModel)]="minMatchPercentage"
                            (input)="onSliderChange($any($event.target).value)"
                            class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary">
                        <div class="flex justify-between text-xs text-softGray mt-1">
                            <span>0%</span>
                            <span class="font-semibold text-primary">{{ minMatchPercentage }}%+</span>
                            <span>100%</span>
                        </div>
                        <div class="mt-3 bg-lightPurple/30 rounded-lg p-3 border border-primary/20">
                            <p class="text-sm font-semibold text-primaryDark text-center">
                                <span>{{ filteredJobs.length }}</span> תפקידים עם התאמות
                            </p>
                        </div>
                    </div>

                    <label class="flex items-center space-x-2 space-x-reverse cursor-pointer group">
                        <input type="checkbox"
                            class="w-4 h-4 rounded border-2 border-gray-200 text-primary focus:ring-2 focus:ring-primary/50">
                        <span class="text-sm text-gray-800 group-hover:text-primary transition-colors">תפקידים ללא
                            התאמה</span>
                    </label>

                    <label class="flex items-center space-x-2 space-x-reverse cursor-pointer group">
                        <input type="checkbox" checked
                            class="w-4 h-4 rounded border-2 border-gray-200 text-primary focus:ring-2 focus:ring-primary/50">
                        <span class="text-sm text-gray-800 group-hover:text-primary transition-colors">המלצות AI
                            בלבד</span>
                    </label>

                    <button (click)="applyFilters()"
                        class="w-full bg-primary hover:bg-primaryDark text-white py-2.5 rounded-lg font-medium text-sm transition-all shadow-md">
                        החל סינון
                    </button>
                    <button (click)="resetFilters()"
                        class="w-full text-softGray hover:text-red-500 text-sm font-medium transition-colors">
                        נקה הכל
                    </button>
                </div>
            </div>

            <div class="h-px bg-gray-200 mb-8"></div>

            <!-- Smart Insights Section -->
            <div>
                <h3 class="text-base font-bold text-gray-800 mb-4">תובנות חכמות</h3>

                <!-- Excellent Matches -->
                <div class="mb-6 pb-6 border-b border-gray-200">
                    <div class="flex items-center space-x-2 space-x-reverse mb-3">
                        <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                            <i class="fa-solid fa-check-double text-green-700"></i>
                        </div>
                        <h4 class="text-sm font-semibold text-gray-800">התאמות מצוינות</h4>
                    </div>
                    <div class="bg-green-50 p-3 rounded-lg border border-green-200">
                        <p class="text-sm font-semibold text-gray-800 mb-1">{{ excellentMatchCount }} תפקידים מעל 80%
                        </p>
                        <p class="text-xs text-softGray">ממוצע מועמדים: 14 לתפקיד</p>
                    </div>
                </div>

                <!-- Urgent Positions -->
                <div class="mb-6 pb-6 border-b border-gray-200">
                    <div class="flex items-center space-x-2 space-x-reverse mb-3">
                        <div class="w-8 h-8 bg-lightPurple rounded-lg flex items-center justify-center">
                            <i class="fa-solid fa-briefcase text-primary"></i>
                        </div>
                        <h4 class="text-sm font-semibold text-gray-800">תפקידים דחופים</h4>
                    </div>
                    <div class="space-y-2">
                        <div *ngFor="let job of filteredJobs.slice(0, 2)"
                            class="flex items-center justify-between p-2 hover:bg-lightPurple/20 rounded-lg cursor-pointer transition-all">
                            <div class="flex-1">
                                <p class="text-sm font-semibold text-gray-800">{{ job.title }}</p>
                                <p class="text-xs text-softGray">{{ job.candidateCount }} מועמדים • {{
                                    job.matchPercentage }}%</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Recommendation -->
                <div>
                    <div class="flex items-center space-x-2 space-x-reverse mb-3">
                        <div class="w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center">
                            <i class="fa-solid fa-lightbulb text-yellow-700"></i>
                        </div>
                        <h4 class="text-sm font-semibold text-gray-800">המלצת AI</h4>
                    </div>
                    <div class="bg-yellow-50 p-3 rounded-lg border border-yellow-200">
                        <p class="text-sm text-gray-800 mb-2">{{ excellentMatchCount }} תפקידים פתוחים עם התאמה גבוהה
                            לעובדים קיימים</p>
                        <p class="text-xs text-softGray">המערכת ממליצה להתחיל בתפקידי הטכנולוגיה</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="flex-1 p-8 overflow-y-auto h-[calc(100vh-80px)]">
        <!-- Top Section -->
        <div class="mb-8">
            <div class="flex items-center justify-between mb-2">
                <div class="flex items-center space-x-4 space-x-reverse">
                    <div class="bg-primary text-white p-3 rounded-lg">
                        <i class="fa-solid fa-users-gear text-2xl"></i>
                    </div>
                    <div>
                        <h2 class="text-2xl font-semibold text-gray-800">התאמת תפקידים</h2>
                        <p class="text-softGray mt-1">תובנות AI למציאת התאמות פנימיות בארגון</p>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-sm p-6 border-l-4 border-green-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-softGray mb-1">התאמות מצוינות</p>
                            <h3 class="text-3xl font-semibold text-gray-800">{{ excellentMatchCount }}</h3>
                            <p class="text-xs text-green-600 font-semibold mt-1">80%+ התאמה</p>
                        </div>
                        <div class="bg-green-100 text-green-600 p-4 rounded-lg">
                            <i class="fa-solid fa-star text-2xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm p-6 border-l-4 border-amber-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-softGray mb-1">התאמות טובות</p>
                            <h3 class="text-3xl font-semibold text-gray-800">{{ goodMatchCount }}</h3>
                            <p class="text-xs text-amber-600 font-semibold mt-1">60-79% התאמה</p>
                        </div>
                        <div class="bg-amber-100 text-amber-600 p-4 rounded-lg">
                            <i class="fa-solid fa-thumbs-up text-2xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm p-6 border-l-4 border-primary">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-softGray mb-1">סה"כ מועמדים</p>
                            <h3 class="text-3xl font-semibold text-gray-800">{{ totalCandidates }}</h3>
                            <p class="text-xs text-primary font-semibold mt-1">עובדים פנימיים</p>
                        </div>
                        <div class="bg-lightPurple text-primary p-4 rounded-lg">
                            <i class="fa-solid fa-users text-2xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm p-6 border-l-4 border-orange-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-softGray mb-1">ללא התאמה</p>
                            <h3 class="text-3xl font-semibold text-gray-800">{{ noMatchCount }}</h3>
                            <p class="text-xs text-orange-600 font-semibold mt-1">דורשים גיוס חיצוני</p>
                        </div>
                        <div class="bg-orange-100 text-orange-600 p-4 rounded-lg">
                            <i class="fa-solid fa-exclamation-triangle text-2xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Jobs Content -->
            <div class="mt-6">
                <div class="flex items-center justify-between mb-5">
                    <div class="text-sm text-softGray flex items-center space-x-2 space-x-reverse">
                        <i class="fa-solid fa-filter text-primary"></i>
                        <span><span class="font-semibold text-gray-800">{{ filteredJobs.length }}</span> תפקידים עם
                            התאמות</span>
                    </div>
                    <div class="flex items-center space-x-3 space-x-reverse">
                        <span class="text-sm text-gray-800 font-normal">מיון:</span>
                        <select [(ngModel)]="sortBy" (change)="applyFilters()"
                            class="bg-white border border-gray-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary/30 focus:border-primary outline-none">
                            <option value="matchPercentage">לפי איכות התאמה</option>
                            <option value="candidateCount">לפי מספר מועמדים</option>
                            <option value="category">לפי קטגוריה</option>
                            <option value="title">לפי שם התפקיד</option>
                        </select>
                    </div>
                </div>

                <!-- Jobs Grid - Dynamic -->
                <div class="space-y-3">
                    <div *ngFor="let job of filteredJobs"
                        class="job-card bg-white rounded-lg p-4 border border-gray-200 hover:border-primary hover:shadow-lg transition-all">
                        <div class="flex items-center gap-4">
                            <div class="flex-shrink-0 w-52">
                                <h4 class="font-semibold text-gray-800 text-base mb-1">{{ job.title }}</h4>
                                <p class="text-xs mb-2">
                                    <span [class]="getMatchPercentageColor(job.matchPercentage)"
                                        class="font-bold text-sm">{{ job.matchPercentage }}%</span>
                                    <span class="text-primary"> {{ job.matchDescription }}</span>
                                </p>
                                <div class="flex items-center space-x-2 space-x-reverse text-sm text-softGray">
                                    <span>{{ job.category }}</span>
                                    <span *ngIf="job.level">·</span>
                                    <span *ngIf="job.level">{{ job.level }}</span>
                                </div>
                                <div class="mt-1 text-xs text-softGray">
                                    <span>אגף: {{ job.division }} | מחלקה: {{ job.department }}</span>
                                </div>
                            </div>

                            <div class="flex items-center space-x-3 space-x-reverse flex-1 justify-center">
                                <span
                                    class="bg-lightPurple text-primaryDark px-2.5 py-1.5 rounded-full text-xs font-medium">{{
                                    job.candidateCount }} מועמדים</span>

                                <div class="flex -space-x-2 space-x-reverse">
                                    <img *ngFor="let candidate of job.candidates" [src]="candidate.avatar" alt="מועמד"
                                        class="w-11 h-11 rounded-full border-2 border-white">
                                </div>
                            </div>

                            <button (click)="viewJobDetails(job)"
                                class="border border-primary text-primary text-sm px-5 py-2 rounded-lg hover:bg-lightPurple/30 transition-all font-normal whitespace-nowrap flex-shrink-0">
                                צפה בהתאמות
                            </button>
                        </div>
                    </div>
                </div>

                <!-- No Results Message -->
                <div *ngIf="filteredJobs.length === 0" class="text-center py-12">
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fa-solid fa-search text-gray-400 text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">לא נמצאו תפקידים</h3>
                    <p class="text-softGray">נסה לשנות את הסינון או להרחיב את החיפוש</p>
                </div>

                <!-- Pagination -->
                <div *ngIf="filteredJobs.length > 0" class="flex justify-center mt-10">
                    <div class="flex space-x-2 space-x-reverse items-center">
                        <button
                            class="w-10 h-10 flex items-center justify-center bg-white border border-gray-200 rounded-full hover:bg-gray-50 transition-colors text-softGray">
                            <i class="fa-solid fa-chevron-right text-xs"></i>
                        </button>
                        <button
                            class="w-10 h-10 flex items-center justify-center bg-primary text-white rounded-full font-semibold">1</button>
                        <button
                            class="w-10 h-10 flex items-center justify-center bg-white border border-gray-200 rounded-full hover:bg-gray-50 transition-colors text-softGray">2</button>
                        <button
                            class="w-10 h-10 flex items-center justify-center bg-white border border-gray-200 rounded-full hover:bg-gray-50 transition-colors text-softGray">
                            <i class="fa-solid fa-chevron-left text-xs"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Job Details View -->
<div *ngIf="selectedJob && !showComparisonView" class="flex flex-col h-[calc(100vh-80px)]">
    <!-- Top Navigation Bar -->
    <div class="bg-white border-b border-gray-200 px-8 py-4">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-6 space-x-reverse">
                <button (click)="closeJobDetails()"
                    class="flex items-center space-x-2 space-x-reverse text-softGray hover:text-primary transition-colors group">
                    <i
                        class="fa-solid fa-arrow-right text-sm group-hover:transform group-hover:translate-x-1 transition-transform"></i>
                    <span class="font-medium">חזרה לכל התפקידים</span>
                </button>
                <div class="h-6 w-px bg-gray-200"></div>
                <div>
                    <h1 class="text-2xl font-bold text-gray-800 mb-1">{{ $any(selectedJob).title }}</h1>
                    <div class="flex items-center space-x-3 space-x-reverse">
                        <span class="bg-green-100 text-green-700 text-xs font-semibold px-3 py-1 rounded-lg">תפקיד
                            פעיל</span>
                        <span class="bg-red-100 text-red-700 text-xs font-semibold px-3 py-1 rounded-lg">דחוף</span>
                        <span class="bg-blue-100 text-blue-700 text-xs font-semibold px-3 py-1 rounded-lg">ניוד
                            פנימי
                            מועדף</span>
                    </div>
                </div>
            </div>
            <div class="flex items-center space-x-6 space-x-reverse text-sm">
                <div>
                    <span class="text-softGray">מחלקה:</span>
                    <span class="font-semibold text-gray-800 mr-2">{{ $any(selectedJob).department }}</span>
                </div>
                <div>
                    <span class="text-softGray">מנהל גיוס:</span>
                    <span class="font-semibold text-gray-800 mr-2">דני רוזן</span>
                </div>
                <div>
                    <span class="text-softGray">היקף משרה:</span>
                    <span class="font-semibold text-gray-800 mr-2">100%</span>
                </div>
            </div>
        </div>
    </div>

    <div class="flex flex-1 overflow-hidden">
        <!-- Right Sidebar - Filters & Insights -->
        <div class="w-80 bg-white border-l border-gray-200 overflow-y-auto">
            <div class="p-6">
                <div class="mb-8">
                    <h3 class="text-base font-bold text-gray-800 mb-4 flex items-center space-x-2 space-x-reverse">
                        <i class="fa-solid fa-sliders text-primary"></i>
                        <span>סינון התאמות</span>
                    </h3>

                    <div class="space-y-6">
                        <!-- Match Threshold -->
                        <div class="pb-6 border-b border-gray-200">
                            <div class="flex items-center justify-between mb-2">
                                <label class="text-sm font-medium text-gray-800">איכות התאמה</label>
                                <div class="flex items-center space-x-2 space-x-reverse">
                                    <span class="text-sm font-semibold text-primary">60%+</span>
                                    <span class="text-xs text-softGray">|</span>
                                    <span class="text-sm font-semibold text-primary">{{ mockCandidates.length }}
                                        עובדים</span>
                                </div>
                            </div>
                            <input type="range" min="0" max="100" value="60"
                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary">
                            <div class="flex justify-between text-xs text-softGray mt-1">
                                <span>0%</span>
                                <span>100%</span>
                            </div>
                        </div>

                        <!-- Filter Options -->
                        <div class="pb-6 border-b border-gray-200 space-y-4">
                            <label class="flex items-center space-x-2 space-x-reverse cursor-pointer group">
                                <input type="checkbox"
                                    class="w-4 h-4 rounded border-2 border-gray-200 text-primary focus:ring-2 focus:ring-primary/50">
                                <span class="text-sm text-gray-800 group-hover:text-primary transition-colors">הצג
                                    עובדים מחפשי תפקיד</span>
                            </label>

                            <label class="flex items-center space-x-2 space-x-reverse cursor-pointer group">
                                <input type="checkbox" checked
                                    class="w-4 h-4 rounded border-2 border-gray-200 text-primary focus:ring-2 focus:ring-primary/50">
                                <span class="text-sm text-gray-800 group-hover:text-primary transition-colors">המלצות
                                    AI בלבד</span>
                            </label>
                        </div>

                        <button class="w-full text-softGray hover:text-red-500 text-sm font-medium transition-colors">
                            נקה הכל
                        </button>
                    </div>
                </div>

                <div class="h-px bg-gray-200 mb-8"></div>

                <div>
                    <h3 class="text-base font-bold text-gray-800 mb-4">תובנות חכמות</h3>

                    <!-- Excellent Matches -->
                    <div class="mb-6 pb-6 border-b border-gray-200">
                        <div class="flex items-center space-x-2 space-x-reverse mb-3">
                            <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                                <i class="fa-solid fa-check-double text-green-700"></i>
                            </div>
                            <h4 class="text-sm font-semibold text-gray-800">התאמות מצוינות</h4>
                        </div>
                        <div class="bg-green-50 p-3 rounded-lg border border-green-200">
                            <p class="text-sm font-semibold text-gray-800 mb-1">5 מועמדים מעל 90%</p>
                            <p class="text-xs text-softGray">ממוצע התאמה: 94%</p>
                        </div>
                    </div>

                    <!-- Looking for Job -->
                    <div class="mb-6 pb-6 border-b border-gray-200">
                        <div class="flex items-center space-x-2 space-x-reverse mb-3">
                            <div class="w-8 h-8 bg-lightPurple rounded-lg flex items-center justify-center">
                                <i class="fa-solid fa-user-check text-primary"></i>
                            </div>
                            <h4 class="text-sm font-semibold text-gray-800">מחפשים תפקיד</h4>
                        </div>
                        <div class="space-y-2">
                            <div *ngFor="let candidate of mockCandidates.slice(0, 2)"
                                class="flex items-center space-x-3 space-x-reverse p-2 hover:bg-lightPurple/20 rounded-lg cursor-pointer transition-all">
                                <img [src]="candidate.avatar" class="w-10 h-10 rounded-full">
                                <div class="flex-1">
                                    <p class="text-sm font-semibold text-gray-800">{{ candidate.name }}</p>
                                    <p class="text-xs text-softGray">התאמה: {{ candidate.matchPercentage }}%</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI Recommendation -->
                    <div>
                        <div class="flex items-center space-x-2 space-x-reverse mb-3">
                            <div class="w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center">
                                <i class="fa-solid fa-lightbulb text-yellow-700"></i>
                            </div>
                            <h4 class="text-sm font-semibold text-gray-800">המלצות AI</h4>
                        </div>
                        <div class="bg-yellow-50 p-3 rounded-lg border border-yellow-200">
                            <p class="text-sm text-gray-800 mb-2">
                                <strong>3 מועמדים</strong> מומלצים במיוחד
                            </p>
                            <p class="text-xs text-softGray">בהתבסס על ניסיון ומיומנויות</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 p-8 overflow-y-auto">
            <!-- Job Hero Card -->
            <div
                class="bg-gradient-to-br from-primary/5 via-white to-lightPurple/30 rounded-2xl shadow-lg p-8 mb-6 border-2 border-primary/20">
                <div class="flex justify-between items-start mb-6">
                    <div class="flex-1">
                        <div class="flex items-center space-x-4 space-x-reverse mb-4">
                            <div
                                class="w-16 h-16 bg-gradient-to-br from-primary to-primaryDark rounded-2xl flex items-center justify-center shadow-lg">
                                <i class="fa-solid fa-code text-white text-3xl"></i>
                            </div>
                            <div>
                                <h2 class="text-3xl font-bold text-gray-800 mb-2">{{ $any(selectedJob).title }}</h2>
                                <p class="text-sm text-softGray">{{ $any(selectedJob).division }} • {{
                                    $any(selectedJob).department
                                    }}</p>
                            </div>
                        </div>

                        <div
                            class="grid grid-cols-4 gap-4 text-sm mb-6 bg-white/70 rounded-xl p-5 border border-gray-200/50">
                            <div>
                                <p class="text-softGray mb-1">רמת התפקיד</p>
                                <p class="font-bold text-gray-800">{{ $any(selectedJob).level }}</p>
                            </div>
                            <div>
                                <p class="text-softGray mb-1">היקף משרה</p>
                                <p class="font-bold text-gray-800">100%</p>
                            </div>
                            <div>
                                <p class="text-softGray mb-1">דיווח ישיר</p>
                                <p class="font-bold text-gray-800">מנהל פיתוח</p>
                            </div>
                            <div>
                                <p class="text-softGray mb-1">מאייש נוכחי</p>
                                <div class="flex items-center space-x-2 space-x-reverse mt-1">
                                    <img src="https://storage.googleapis.com/uxpilot-auth.appspot.com/avatars/avatar-3.jpg"
                                        alt="מאייש" class="w-8 h-8 rounded-full border-2 border-primary shadow-md">
                                    <span class="font-bold text-gray-800">אמיר שמואלי</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="bg-white/90 rounded-xl p-6 border border-primary/10 shadow-sm">
                        <h4 class="font-bold mb-4 text-base text-gray-800 flex items-center space-x-2 space-x-reverse">
                            <i class="fa-regular fa-file-alt text-primary text-xl"></i>
                            <span>תיאור התפקיד</span>
                        </h4>
                        <p class="text-softGray text-sm leading-relaxed">
                            פיתוח ותחזוקה של מערכות web מורכבות בסביבת עבודה דינמית ומאתגרת. העבודה כוללת עיצוב
                            וביצוע
                            של ארכיטקטורות מערכת מורכבות, עבודה עם טכנולוגיות מתקדמות כולל React, Node.js,
                            TypeScript
                            ו-AWS. הובלת פרויקטים טכנולוגיים מקצה לקצה, ליווי והדרכת מפתחים זוטרים, וביצוע code
                            reviews.
                        </p>
                    </div>

                    <div class="bg-white/90 rounded-xl p-6 border border-primary/10 shadow-sm">
                        <h4 class="font-bold mb-4 text-base text-gray-800 flex items-center space-x-2 space-x-reverse">
                            <i class="fa-solid fa-clipboard-check text-primary text-xl"></i>
                            <span>דרישות התפקיד</span>
                        </h4>
                        <ul class="text-gray-800 text-sm space-y-3">
                            <li class="flex items-center space-x-2 space-x-reverse">
                                <i class="fa-solid fa-check-circle text-green-600 text-lg"></i>
                                <span>תואר ראשון במדעי המחשב / הנדסת תוכנה</span>
                            </li>
                            <li class="flex items-center space-x-2 space-x-reverse">
                                <i class="fa-solid fa-check-circle text-green-600 text-lg"></i>
                                <span>ניסיון של 5+ שנים בפיתוח Full Stack</span>
                            </li>
                            <li class="flex items-center space-x-2 space-x-reverse">
                                <i class="fa-solid fa-check-circle text-green-600 text-lg"></i>
                                <span>יכולת הובלת צוות ומנטורינג</span>
                            </li>
                        </ul>
                    </div>

                    <div class="bg-white/90 rounded-xl p-6 border border-primary/10 shadow-sm">
                        <h4 class="font-bold mb-4 text-base text-gray-800 flex items-center space-x-2 space-x-reverse">
                            <i class="fa-solid fa-star text-primary text-xl"></i>
                            <span>כישורים נדרשים</span>
                        </h4>
                        <div class="flex flex-wrap gap-2.5">
                            <span
                                class="bg-primary/10 border-2 border-primary/30 text-primary text-sm px-6 py-2.5 rounded-xl font-semibold shadow-sm">React</span>
                            <span
                                class="bg-primary/10 border-2 border-primary/30 text-primary text-sm px-6 py-2.5 rounded-xl font-semibold shadow-sm">Node.js</span>
                            <span
                                class="bg-primary/10 border-2 border-primary/30 text-primary text-sm px-6 py-2.5 rounded-xl font-semibold shadow-sm">AWS</span>
                            <span
                                class="bg-primary/10 border-2 border-primary/30 text-primary text-sm px-6 py-2.5 rounded-xl font-semibold shadow-sm">TypeScript</span>
                            <span
                                class="bg-primary/10 border-2 border-primary/30 text-primary text-sm px-6 py-2.5 rounded-xl font-semibold shadow-sm">MongoDB</span>
                            <span
                                class="bg-primary/10 border-2 border-primary/30 text-primary text-sm px-6 py-2.5 rounded-xl font-semibold shadow-sm">Docker</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Search Controls -->
            <div class="bg-white rounded-2xl shadow-sm p-5 mb-5 border border-gray-200">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center space-x-4 space-x-reverse">
                        <h3 class="text-lg font-semibold text-gray-800">מועמדים פוטנציאליים</h3>
                        <span
                            class="bg-lightPurple text-primary text-xs font-semibold px-3 py-1 rounded-lg border border-primary/20">{{
                            mockCandidates.length }} מועמדים</span>
                        <div class="flex items-center space-x-2 space-x-reverse border-r border-gray-200 pr-4">
                            <button class="p-2 bg-lightPurple text-primary rounded-lg transition-all">
                                <i class="fa-solid fa-grip text-sm"></i>
                            </button>
                            <button
                                class="p-2 bg-gray-100 text-softGray rounded-lg hover:bg-lightPurple hover:text-primary transition-all">
                                <i class="fa-solid fa-list text-sm"></i>
                            </button>
                            <button
                                class="p-2 bg-gray-100 text-softGray rounded-lg hover:bg-lightPurple hover:text-primary transition-all">
                                <i class="fa-solid fa-table text-sm"></i>
                            </button>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3 space-x-reverse">
                        <button (click)="openComparisonView()" [disabled]="selectedCandidateCount < 2"
                            [class]="selectedCandidateCount >= 2 ? 'bg-primary hover:bg-primaryDark text-white' : 'bg-gray-300 text-gray-500 cursor-not-allowed'"
                            class="px-4 py-2 rounded-lg transition-all flex items-center space-x-2 space-x-reverse font-medium text-sm shadow-lg">
                            <i class="fa-regular fa-clone text-sm"></i>
                            <span>השוואה בין מועמדים</span>
                            <span class="bg-white/20 text-xs px-2 py-0.5 rounded-full">{{
                                selectedCandidateCount }}</span>
                        </button>
                    </div>
                </div>
                <div class="flex space-x-3 space-x-reverse">
                    <div class="relative flex-1">
                        <input type="text" placeholder="חיפוש מועמד לפי שם..."
                            class="w-full pr-9 pl-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary bg-gray-50 text-sm">
                        <i
                            class="fa-solid fa-search absolute right-3 top-1/2 transform -translate-y-1/2 text-softGray text-sm"></i>
                    </div>
                    <select
                        class="border border-gray-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary bg-gray-50 text-sm text-gray-800">
                        <option>מיון: אחוז התאמה (גבוה לנמוך)</option>
                        <option>מיון: אחוז התאמה (נמוך לגבוה)</option>
                        <option>מיון: שנות ניסיון</option>
                    </select>
                </div>
            </div>

            <!-- Candidates Grid -->
            <div class="space-y-4">
                <div *ngFor="let candidate of mockCandidates"
                    class="bg-white rounded-2xl shadow-sm hover:shadow-md transition-all border border-gray-200 overflow-hidden cursor-pointer">
                    <div class="p-5">
                        <div class="flex items-start space-x-4 space-x-reverse">
                            <div class="relative flex-shrink-0">
                                <img [src]="candidate.avatar" alt="מועמד"
                                    class="w-16 h-16 rounded-full border-2 border-primary shadow-lg">
                                <button
                                    class="absolute -top-1 -right-1 w-6 h-6 bg-white rounded-full shadow-md border border-gray-200 hover:bg-yellow-50 transition-all flex items-center justify-center">
                                    <i class="fa-regular fa-star text-softGray text-xs hover:text-yellow-500"></i>
                                </button>
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-start justify-between mb-3">
                                    <div class="flex-1">
                                        <div class="flex items-center space-x-3 space-x-reverse mb-1">
                                            <h3 class="text-lg font-semibold text-gray-800">{{ candidate.name }}
                                            </h3>
                                            <span class="text-gray-300">|</span>
                                            <label
                                                class="flex items-center space-x-2 space-x-reverse cursor-pointer group">
                                                <input type="checkbox" [checked]="candidate.selected"
                                                    (change)="toggleCandidateSelection(candidate)"
                                                    class="w-4 h-4 rounded border-2 border-gray-200 text-primary focus:ring-2 focus:ring-primary/50 cursor-pointer transition-all">
                                                <span
                                                    [class]="candidate.selected ? 'text-primary font-semibold' : 'text-softGray'"
                                                    class="text-xs group-hover:text-primary transition-colors font-medium">להשוואה</span>
                                            </label>
                                            <div class="flex items-center space-x-2 space-x-reverse mr-2">
                                                <button
                                                    class="w-7 h-7 rounded-lg border border-gray-200 hover:border-primary hover:bg-lightPurple/20 transition-all flex items-center justify-center group"
                                                    title="הוסף הערה">
                                                    <i
                                                        class="fa-regular fa-comment-dots text-sm text-softGray group-hover:text-primary transition-colors"></i>
                                                </button>
                                                <button
                                                    class="w-7 h-7 rounded-lg border border-gray-200 hover:border-red-500 hover:bg-red-50 transition-all flex items-center justify-center group"
                                                    title="לא מתאים לתפקיד">
                                                    <i
                                                        class="fa-solid fa-times text-sm text-softGray group-hover:text-red-600 transition-colors"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <p class="text-sm text-softGray mb-1">{{ candidate.education }} | {{
                                            candidate.experience }} שנים ניסיון</p>
                                        <div
                                            class="flex items-center space-x-2 space-x-reverse text-sm text-softGray mb-1">
                                            <span>{{ candidate.division }}</span>
                                            <span>•</span>
                                            <span>{{ candidate.department }}</span>
                                        </div>
                                        <p class="text-sm text-softGray">תפקיד נוכחי: {{ candidate.currentRole }} •
                                            ותק:
                                            {{ candidate.tenure }}</p>
                                    </div>
                                    <div class="flex items-center space-x-3 space-x-reverse mr-4">
                                        <div class="relative w-16 h-16 flex-shrink-0">
                                            <svg class="transform -rotate-90" width="64" height="64">
                                                <circle cx="32" cy="32" r="28" stroke="#E0E0E0" stroke-width="4"
                                                    fill="none"></circle>
                                                <circle cx="32" cy="32" r="28" stroke="#650f54" stroke-width="4"
                                                    fill="none" stroke-dasharray="175.93"
                                                    [attr.stroke-dashoffset]="getStrokeDashoffset(candidate.matchPercentage || 0)"
                                                    stroke-linecap="round"></circle>
                                            </svg>
                                            <div class="absolute inset-0 flex items-center justify-center">
                                                <span class="text-lg font-bold text-primary">{{
                                                    candidate.matchPercentage }}%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="grid grid-cols-3 gap-3 mb-3 text-sm">
                                    <div class="bg-gray-100 rounded-lg p-2">
                                        <p class="text-softGray text-xs mb-0.5">מיקום</p>
                                        <p class="font-semibold text-gray-800">{{ candidate.location }}</p>
                                    </div>
                                    <div class="bg-gray-100 rounded-lg p-2">
                                        <p class="text-softGray text-xs mb-0.5">זמינות</p>
                                        <p [class]="getAvailabilityColor(candidate.availability || '')"
                                            class="font-semibold">{{ candidate.availability }}</p>
                                    </div>
                                    <div class="bg-gray-100 rounded-lg p-2">
                                        <p class="text-softGray text-xs mb-0.5">שכר נוכחי</p>
                                        <p class="font-semibold text-gray-800">{{ candidate.salary }}</p>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <p class="text-sm font-semibold text-gray-800 mb-2">כישורים קריטיים למשרה:</p>
                                    <div class="flex flex-wrap gap-1.5">
                                        <ng-container *ngFor="let skill of candidate.skills">
                                            <span *ngIf="skill.matched"
                                                class="bg-green-100 text-green-700 text-xs px-2.5 py-1 rounded-full flex items-center space-x-1 space-x-reverse font-medium">
                                                <i class="fa-solid fa-check text-[10px]"></i><span>{{ skill.name
                                                    }}</span>
                                            </span>
                                            <span *ngIf="!skill.matched"
                                                class="bg-red-100 text-red-700 text-xs px-2.5 py-1 rounded-full flex items-center space-x-1 space-x-reverse font-medium">
                                                <i class="fa-solid fa-times text-[10px]"></i><span>{{ skill.name
                                                    }}</span>
                                            </span>
                                        </ng-container>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <p class="text-sm font-semibold text-gray-800 mb-2">כישורים נוספים:</p>
                                    <div class="flex flex-wrap gap-1.5">
                                        <span *ngFor="let skill of candidate.additionalSkills"
                                            class="bg-lightPurple text-primary text-xs px-2.5 py-1 rounded-full font-medium">{{
                                            skill }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-lightPurple/20 p-3">
                        <div class="flex justify-around text-center">
                            <div>
                                <p class="text-xs text-softGray">התאמת מיומנויות</p>
                                <p class="text-lg font-bold text-primaryDark">{{ candidate.skillsMatch }}%</p>
                            </div>
                            <div>
                                <p class="text-xs text-softGray">התאמת ניסיון</p>
                                <p class="text-lg font-bold text-primaryDark">{{ candidate.experienceMatch }}%</p>
                            </div>
                            <div>
                                <p class="text-xs text-softGray">התאמת השכלה</p>
                                <p class="text-lg font-bold text-primaryDark">{{ candidate.educationMatch }}%</p>
                            </div>
                            <div>
                                <p class="text-xs text-softGray">התאמה תרבותית</p>
                                <p class="text-lg font-bold text-primaryDark">{{ candidate.cultureMatch }}%</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Comparison View -->
<div *ngIf="showComparisonView" class="p-6 overflow-y-auto h-[calc(100vh-80px)]">
    <div class="max-w-[1400px] mx-auto">
        <!-- Comparison Header -->
        <div class="mb-6">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center space-x-4 space-x-reverse">
                    <button (click)="closeComparisonView()" class="text-softGray hover:text-primary transition-colors">
                        <i class="fa-solid fa-arrow-right text-xl"></i>
                    </button>
                    <h1 class="text-2xl font-bold text-gray-800">השוואת מועמדים</h1>
                    <span
                        class="bg-lightPurple text-primary text-sm font-semibold px-3 py-1 rounded-lg border border-primary/20">{{
                        selectedCandidateCount }} מועמדים</span>
                </div>
                <div class="flex items-center space-x-3 space-x-reverse">
                    <button
                        class="border border-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-50 transition-colors flex items-center space-x-2 space-x-reverse font-medium text-sm">
                        <i class="fa-solid fa-download text-sm text-softGray"></i><span>ייצא השוואה</span>
                    </button>
                </div>
            </div>

            <!-- Job Info Card -->
            <div *ngIf="selectedJob" class="bg-white rounded-2xl shadow-sm p-5 border border-gray-200 mb-4">
                <div class="flex items-center space-x-3 space-x-reverse">
                    <div class="w-12 h-12 bg-lightPurple rounded-full flex items-center justify-center">
                        <i class="fa-solid fa-code text-primary text-xl"></i>
                    </div>
                    <div class="flex-1">
                        <h2 class="text-lg font-semibold text-gray-800">{{ $any(selectedJob).title }}</h2>
                        <p class="text-sm text-softGray">{{ $any(selectedJob).division }} • {{
                            $any(selectedJob).department }}
                        </p>
                    </div>
                </div>
            </div>

            <!-- AI Summary -->
            <div *ngIf="getLeadCandidate()"
                class="bg-gradient-to-br from-lightPurple/30 to-lightPurple/10 rounded-2xl p-6 border border-primary/20">
                <div class="flex items-start space-x-4 space-x-reverse mb-4">
                    <div class="w-10 h-10 bg-primary rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fa-solid fa-sparkles text-white text-lg"></i>
                    </div>
                    <div class="flex-1">
                        <h3 class="font-semibold text-gray-800 text-lg mb-2">סיכום AI - מועמד מוביל</h3>
                        <p class="text-sm text-gray-800 leading-relaxed">
                            <strong class="text-primary text-base">{{ getLeadCandidate()?.name }}</strong> בולט
                            כמועמד
                            המתאים ביותר עם התאמה של <strong class="text-primary">{{
                                getLeadCandidate()?.matchPercentage
                                }}%</strong>.
                            עם {{ getLeadCandidate()?.experience }} שנות ניסיון רלוונטי ויכולות הובלת צוותים מוכחות,
                            המועמד מציג שילוב אידיאלי של מומחיות טכנית והתאמה תרבותית גבוהה.
                        </p>
                    </div>
                </div>

                <div class="grid grid-cols-3 gap-4">
                    <div class="bg-white/60 rounded-lg p-4">
                        <h4
                            class="font-semibold text-gray-800 mb-3 flex items-center space-x-2 space-x-reverse text-sm">
                            <i class="fa-solid fa-check-circle text-green-600 text-base"></i>
                            <span>יתרונות מרכזיים</span>
                        </h4>
                        <ul class="space-y-2 text-sm text-gray-800">
                            <li class="flex items-start space-x-2 space-x-reverse">
                                <span class="text-primary mt-0.5">•</span>
                                <span>ניסיון בחברות מובילות</span>
                            </li>
                            <li class="flex items-start space-x-2 space-x-reverse">
                                <span class="text-primary mt-0.5">•</span>
                                <span>ניהול צוותים והובלת פרויקטים</span>
                            </li>
                            <li class="flex items-start space-x-2 space-x-reverse">
                                <span class="text-primary mt-0.5">•</span>
                                <span>שליטה מלאה בטכנולוגיות</span>
                            </li>
                        </ul>
                    </div>

                    <div class="bg-white/60 rounded-lg p-4">
                        <h4
                            class="font-semibold text-gray-800 mb-3 flex items-center space-x-2 space-x-reverse text-sm">
                            <i class="fa-solid fa-balance-scale text-primary text-base"></i>
                            <span>השוואה למועמדים</span>
                        </h4>
                        <ul class="space-y-2 text-sm text-gray-800">
                            <li class="flex items-start space-x-2 space-x-reverse">
                                <span class="text-primary mt-0.5">•</span>
                                <span>ניסיון רחב יותר ב-Full Stack</span>
                            </li>
                            <li class="flex items-start space-x-2 space-x-reverse">
                                <span class="text-primary mt-0.5">•</span>
                                <span>התאמה גבוהה בכישורים רכים</span>
                            </li>
                            <li class="flex items-start space-x-2 space-x-reverse">
                                <span class="text-primary mt-0.5">•</span>
                                <span>מכיר את התרבות הארגונית</span>
                            </li>
                        </ul>
                    </div>

                    <div class="bg-white/60 rounded-lg p-4">
                        <h4
                            class="font-semibold text-gray-800 mb-3 flex items-center space-x-2 space-x-reverse text-sm">
                            <i class="fa-solid fa-lightbulb text-yellow-500 text-base"></i>
                            <span>המלצה לפעולה</span>
                        </h4>
                        <p class="text-sm text-gray-800 leading-relaxed">
                            מומלץ להתחיל בשיחה עם {{ getLeadCandidate()?.name }} על האפשרות למעבר לתפקיד זה.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="mb-6 bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
            <h3 class="font-semibold text-gray-800 text-base mb-4 flex items-center space-x-2 space-x-reverse">
                <i class="fa-solid fa-chart-bar text-primary"></i>
                <span>ניתוח התאמה מקיף</span>
            </h3>
            <div class="grid gap-6"
                [ngClass]="{'grid-cols-2': selectedCandidateCount === 2, 'grid-cols-3': selectedCandidateCount >= 3}">
                <div *ngFor="let candidate of selectedCandidatesForComparison; let i = index">
                    <div [id]="'chart-candidate-' + (i + 1)" style="height: 280px;"></div>
                </div>
            </div>
        </div>

        <!-- Comparison Table -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-gray-200">
                            <th class="text-right p-5 bg-gray-50 font-semibold text-gray-800 w-64 sticky right-0 z-10">
                                קריטריון</th>
                            <th *ngFor="let candidate of selectedCandidatesForComparison"
                                class="p-5 bg-white border-r border-gray-200">
                                <div class="flex flex-col items-center space-y-3">
                                    <div class="relative">
                                        <img [src]="candidate.avatar" alt="מועמד"
                                            class="w-20 h-20 rounded-full border-4 border-primary shadow-lg">
                                        <div
                                            class="absolute -bottom-2 left-1/2 transform -translate-x-1/2 bg-primary text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg">
                                            {{ candidate.matchPercentage }}%</div>
                                    </div>
                                    <div class="text-center">
                                        <h3 class="font-semibold text-gray-800 text-base">{{ candidate.name }}</h3>
                                        <p class="text-xs text-softGray mt-1">{{ candidate.education }} | {{
                                            candidate.experience }} שנים</p>
                                    </div>
                                </div>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Match Percentages Section -->
                        <tr class="border-b border-gray-200 bg-lightPurple/10">
                            <td colspan="10"
                                class="p-3 font-semibold text-gray-800 text-sm sticky right-0 z-10 bg-lightPurple/10">
                                <i class="fa-solid fa-chart-line ml-2 text-primary"></i>אחוזי התאמה מפורטים
                            </td>
                        </tr>
                        <tr class="border-b border-gray-200 hover:bg-gray-50 transition-colors">
                            <td
                                class="p-4 text-right font-medium text-gray-800 sticky right-0 z-10 bg-white border-l border-gray-200">
                                התאמת מיומנויות</td>
                            <td *ngFor="let candidate of selectedCandidatesForComparison"
                                class="p-4 text-center border-r border-gray-200">
                                <div class="flex items-center justify-center space-x-2 space-x-reverse">
                                    <span class="text-base font-semibold text-primary">{{ candidate.skillsMatch
                                        }}%</span>
                                    <div class="w-32 h-3 bg-gray-100 rounded-full overflow-hidden">
                                        <div class="h-full bg-gradient-to-l from-primary/60 to-primary rounded-full transition-all duration-500"
                                            [style.width.%]="candidate.skillsMatch"></div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr class="border-b border-gray-200 hover:bg-gray-50 transition-colors">
                            <td
                                class="p-4 text-right font-medium text-gray-800 sticky right-0 z-10 bg-white border-l border-gray-200">
                                התאמת ניסיון</td>
                            <td *ngFor="let candidate of selectedCandidatesForComparison"
                                class="p-4 text-center border-r border-gray-200">
                                <div class="flex items-center justify-center space-x-2 space-x-reverse">
                                    <span class="text-base font-semibold text-primary">{{ candidate.experienceMatch
                                        }}%</span>
                                    <div class="w-32 h-3 bg-gray-100 rounded-full overflow-hidden">
                                        <div class="h-full bg-gradient-to-l from-primary/60 to-primary rounded-full transition-all duration-500"
                                            [style.width.%]="candidate.experienceMatch"></div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr class="border-b border-gray-200 hover:bg-gray-50 transition-colors">
                            <td
                                class="p-4 text-right font-medium text-gray-800 sticky right-0 z-10 bg-white border-l border-gray-200">
                                התאמת השכלה</td>
                            <td *ngFor="let candidate of selectedCandidatesForComparison"
                                class="p-4 text-center border-r border-gray-200">
                                <div class="flex items-center justify-center space-x-2 space-x-reverse">
                                    <span class="text-base font-semibold text-green-600">{{ candidate.educationMatch
                                        }}%</span>
                                    <div class="w-32 h-3 bg-green-50 rounded-full overflow-hidden">
                                        <div class="h-full bg-gradient-to-l from-green-200 to-green-400 rounded-full transition-all duration-500"
                                            [style.width.%]="candidate.educationMatch"></div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr class="border-b border-gray-200 hover:bg-gray-50 transition-colors">
                            <td
                                class="p-4 text-right font-medium text-gray-800 sticky right-0 z-10 bg-white border-l border-gray-200">
                                התאמה תרבותית</td>
                            <td *ngFor="let candidate of selectedCandidatesForComparison"
                                class="p-4 text-center border-r border-gray-200">
                                <div class="flex items-center justify-center space-x-2 space-x-reverse">
                                    <span
                                        [class]="(candidate.cultureMatch || 0) >= 80 ? 'text-primary' : 'text-amber-500'"
                                        class="text-base font-semibold">{{ candidate.cultureMatch }}%</span>
                                    <div [class]="(candidate.cultureMatch || 0) >= 80 ? 'bg-purple-50' : 'bg-amber-50'"
                                        class="w-32 h-3 rounded-full overflow-hidden">
                                        <div [class]="(candidate.cultureMatch || 0) >= 80 ? 'bg-gradient-to-l from-purple-200 to-purple-400' : 'bg-gradient-to-l from-amber-200 to-amber-400'"
                                            class="h-full rounded-full transition-all duration-500"
                                            [style.width.%]="candidate.cultureMatch || 0"></div>
                                    </div>
                                </div>
                            </td>
                        </tr>

                        <!-- Professional Details Section -->
                        <tr class="border-b border-gray-200 bg-lightPurple/10">
                            <td colspan="10"
                                class="p-3 font-semibold text-gray-800 text-sm sticky right-0 z-10 bg-lightPurple/10">
                                <i class="fa-solid fa-briefcase ml-2 text-primary"></i>פרטים מקצועיים
                            </td>
                        </tr>
                        <tr class="border-b border-gray-200 hover:bg-gray-50 transition-colors">
                            <td
                                class="p-4 text-right font-medium text-gray-800 sticky right-0 z-10 bg-white border-l border-gray-200">
                                תפקיד נוכחי</td>
                            <td *ngFor="let candidate of selectedCandidatesForComparison"
                                class="p-4 text-center border-r border-gray-200">
                                <p class="font-semibold text-gray-800">{{ candidate.currentRole }}</p>
                                <p class="text-xs text-softGray mt-1">ותק: {{ candidate.tenure }}</p>
                            </td>
                        </tr>
                        <tr class="border-b border-gray-200 hover:bg-gray-50 transition-colors">
                            <td
                                class="p-4 text-right font-medium text-gray-800 sticky right-0 z-10 bg-white border-l border-gray-200">
                                אגף ומחלקה</td>
                            <td *ngFor="let candidate of selectedCandidatesForComparison"
                                class="p-4 text-center border-r border-gray-200">
                                <p class="text-sm text-gray-800">{{ candidate.division }}</p>
                                <p class="text-xs text-softGray mt-1">{{ candidate.department }}</p>
                            </td>
                        </tr>
                        <tr class="border-b border-gray-200 hover:bg-gray-50 transition-colors">
                            <td
                                class="p-4 text-right font-medium text-gray-800 sticky right-0 z-10 bg-white border-l border-gray-200">
                                שנות ניסיון כולל</td>
                            <td *ngFor="let candidate of selectedCandidatesForComparison"
                                class="p-4 text-center border-r border-gray-200">
                                <span class="text-lg font-bold text-primary">{{ candidate.experience }}</span>
                            </td>
                        </tr>
                        <tr class="border-b border-gray-200 hover:bg-gray-50 transition-colors">
                            <td
                                class="p-4 text-right font-medium text-gray-800 sticky right-0 z-10 bg-white border-l border-gray-200">
                                השכלה</td>
                            <td *ngFor="let candidate of selectedCandidatesForComparison"
                                class="p-4 text-center border-r border-gray-200">
                                <p class="text-sm text-gray-800 font-semibold">{{ candidate.education }}</p>
                                <p class="text-xs text-softGray mt-1">תואר ראשון</p>
                            </td>
                        </tr>

                        <!-- Skills Section -->
                        <tr class="border-b border-gray-200 bg-lightPurple/10">
                            <td colspan="10"
                                class="p-3 font-semibold text-gray-800 text-sm sticky right-0 z-10 bg-lightPurple/10">
                                <i class="fa-solid fa-star ml-2 text-primary"></i>כישורים קריטיים למשרה
                            </td>
                        </tr>
                        <tr class="border-b border-gray-200 hover:bg-gray-50 transition-colors">
                            <td
                                class="p-4 text-right font-medium text-gray-800 sticky right-0 z-10 bg-white border-l border-gray-200">
                                React</td>
                            <td *ngFor="let candidate of selectedCandidatesForComparison"
                                class="p-4 text-center border-r border-gray-200">
                                <div class="flex items-center justify-center">
                                    <span *ngIf="hasSkill(candidate, 'React')"
                                        class="bg-green-100 text-green-700 text-sm px-3 py-1 rounded-full flex items-center space-x-1 space-x-reverse font-medium">
                                        <i class="fa-solid fa-check text-xs"></i><span>יש</span>
                                    </span>
                                    <span *ngIf="!hasSkill(candidate, 'React')"
                                        class="bg-red-100 text-red-700 text-sm px-3 py-1 rounded-full flex items-center space-x-1 space-x-reverse font-medium">
                                        <i class="fa-solid fa-times text-xs"></i><span>אין</span>
                                    </span>
                                </div>
                            </td>
                        </tr>
                        <tr class="border-b border-gray-200 hover:bg-gray-50 transition-colors">
                            <td
                                class="p-4 text-right font-medium text-gray-800 sticky right-0 z-10 bg-white border-l border-gray-200">
                                Node.js</td>
                            <td *ngFor="let candidate of selectedCandidatesForComparison"
                                class="p-4 text-center border-r border-gray-200">
                                <div class="flex items-center justify-center">
                                    <span *ngIf="hasSkill(candidate, 'Node.js')"
                                        class="bg-green-100 text-green-700 text-sm px-3 py-1 rounded-full flex items-center space-x-1 space-x-reverse font-medium">
                                        <i class="fa-solid fa-check text-xs"></i><span>יש</span>
                                    </span>
                                    <span *ngIf="!hasSkill(candidate, 'Node.js')"
                                        class="bg-red-100 text-red-700 text-sm px-3 py-1 rounded-full flex items-center space-x-1 space-x-reverse font-medium">
                                        <i class="fa-solid fa-times text-xs"></i><span>אין</span>
                                    </span>
                                </div>
                            </td>
                        </tr>
                        <tr class="border-b border-gray-200 hover:bg-gray-50 transition-colors">
                            <td
                                class="p-4 text-right font-medium text-gray-800 sticky right-0 z-10 bg-white border-l border-gray-200">
                                AWS</td>
                            <td *ngFor="let candidate of selectedCandidatesForComparison"
                                class="p-4 text-center border-r border-gray-200">
                                <div class="flex items-center justify-center">
                                    <span *ngIf="hasSkill(candidate, 'AWS')"
                                        class="bg-green-100 text-green-700 text-sm px-3 py-1 rounded-full flex items-center space-x-1 space-x-reverse font-medium">
                                        <i class="fa-solid fa-check text-xs"></i><span>יש</span>
                                    </span>
                                    <span *ngIf="!hasSkill(candidate, 'AWS')"
                                        class="bg-red-100 text-red-700 text-sm px-3 py-1 rounded-full flex items-center space-x-1 space-x-reverse font-medium">
                                        <i class="fa-solid fa-times text-xs"></i><span>אין</span>
                                    </span>
                                </div>
                            </td>
                        </tr>

                        <!-- Additional Info Section -->
                        <tr class="border-b border-gray-200 bg-lightPurple/10">
                            <td colspan="10"
                                class="p-3 font-semibold text-gray-800 text-sm sticky right-0 z-10 bg-lightPurple/10">
                                <i class="fa-solid fa-info-circle ml-2 text-primary"></i>פרטים נוספים
                            </td>
                        </tr>
                        <tr class="border-b border-gray-200 hover:bg-gray-50 transition-colors">
                            <td
                                class="p-4 text-right font-medium text-gray-800 sticky right-0 z-10 bg-white border-l border-gray-200">
                                מיקום</td>
                            <td *ngFor="let candidate of selectedCandidatesForComparison"
                                class="p-4 text-center border-r border-gray-200 text-gray-800">{{ candidate.location
                                }}
                            </td>
                        </tr>
                        <tr class="border-b border-gray-200 hover:bg-gray-50 transition-colors">
                            <td
                                class="p-4 text-right font-medium text-gray-800 sticky right-0 z-10 bg-white border-l border-gray-200">
                                זמינות</td>
                            <td *ngFor="let candidate of selectedCandidatesForComparison"
                                class="p-4 text-center border-r border-gray-200">
                                <span
                                    [class]="candidate.availability === 'מיידית' ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'"
                                    class="text-sm px-3 py-1 rounded-full font-medium">{{ candidate.availability
                                    }}</span>
                            </td>
                        </tr>
                        <tr class="border-b border-gray-200 hover:bg-gray-50 transition-colors">
                            <td
                                class="p-4 text-right font-medium text-gray-800 sticky right-0 z-10 bg-white border-l border-gray-200">
                                שכר נוכחי</td>
                            <td *ngFor="let candidate of selectedCandidatesForComparison"
                                class="p-4 text-center border-r border-gray-200 text-gray-800 font-semibold">{{
                                candidate.salary }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Summary Cards -->
        <div class="mt-6 grid gap-4"
            [ngClass]="{'grid-cols-2': selectedCandidateCount === 2, 'grid-cols-3': selectedCandidateCount >= 3}">
            <div *ngFor="let candidate of selectedCandidatesForComparison; let i = index"
                class="bg-white rounded-2xl shadow-sm p-5 border border-gray-200">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="font-semibold text-gray-800">{{ candidate.name }}</h3>
                    <div class="relative w-12 h-12 flex-shrink-0">
                        <svg class="transform -rotate-90" width="48" height="48">
                            <circle cx="24" cy="24" r="20" stroke="#E0E0E0" stroke-width="3" fill="none"></circle>
                            <circle cx="24" cy="24" r="20" stroke="#650f54" stroke-width="3" fill="none"
                                stroke-dasharray="125.66"
                                [attr.stroke-dashoffset]="getSmallStrokeDashoffset(candidate.matchPercentage || 0)"
                                stroke-linecap="round"></circle>
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span class="text-sm font-bold text-primary">{{ candidate.matchPercentage }}%</span>
                        </div>
                    </div>
                </div>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <span class="text-softGray">יתרונות:</span>
                        <span class="font-semibold"
                            [class]="(candidate.matchPercentage || 0) >= 90 ? 'text-green-700' : 'text-primary'">
                            {{ (candidate.matchPercentage || 0) >= 90 ? 'התאמה גבוהה מאוד' :
                            ((candidate.matchPercentage
                            || 0) >= 80 ?
                            'התאמה טובה' : 'ניסיון טוב') }}
                        </span>
                    </div>
                    <button
                        [class]="i === 0 ? 'bg-primary hover:bg-primaryDark text-white' : 'border border-primary text-primary hover:bg-lightPurple/30'"
                        class="w-full py-2 rounded-lg transition-all mt-3 font-medium">
                        בחר מועמד
                    </button>
                </div>
            </div>
        </div>

        <!-- Recommendation Box -->
        <div *ngIf="getLeadCandidate()" class="mt-6 bg-lightPurple/20 rounded-2xl p-6 border-2 border-primary/30">
            <div class="flex items-start space-x-4 space-x-reverse">
                <div class="w-12 h-12 bg-primary rounded-full flex items-center justify-center flex-shrink-0">
                    <i class="fa-solid fa-lightbulb text-white text-xl"></i>
                </div>
                <div class="flex-1">
                    <h3 class="font-bold text-gray-800 text-lg mb-2">המלצת המערכת</h3>
                    <p class="text-gray-800 mb-3">
                        על פי ניתוח מקיף של כל הקריטריונים, <strong>{{ getLeadCandidate()?.name }}</strong> הוא
                        המועמד
                        המומלץ ביותר לתפקיד זה עם התאמה של {{ getLeadCandidate()?.matchPercentage }}%.
                        הוא עומד בכל הדרישות הקריטיות, בעל ניסיון רלוונטי וזמין באופן מיידי.
                    </p>
                    <div class="flex space-x-3 space-x-reverse">
                        <button
                            class="bg-primary hover:bg-primaryDark text-white px-5 py-2.5 rounded-lg transition-all font-medium shadow-lg shadow-primary/20">
                            אשר המלצה והמשך לתהליך
                        </button>
                        <button (click)="closeComparisonView()"
                            class="border border-gray-200 text-gray-800 px-5 py-2.5 rounded-lg hover:bg-gray-50 transition-colors font-medium">
                            המשך חיפוש
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>